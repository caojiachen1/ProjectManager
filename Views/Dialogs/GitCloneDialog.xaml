<ui:ContentDialog
    x:Class="ProjectManager.Views.Dialogs.GitCloneDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    Title="从Git仓库克隆项目"
    PrimaryButtonText="克隆"
    SecondaryButtonText="取消"
    DefaultButton="Primary"
    d:DesignHeight="500"
    d:DesignWidth="600"
    mc:Ignorable="d">

    <ui:ContentDialog.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <BooleanToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter"/>
    </ui:ContentDialog.Resources>

    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- 说明文本 -->
        <TextBlock Grid.Row="0" 
                   Text="输入Git仓库URL和本地存储路径来克隆项目" 
                   FontSize="14" 
                   Opacity="0.7" 
                   Margin="0,0,0,16"/>

        <!-- 仓库URL输入 -->
        <StackPanel Grid.Row="1" Margin="0,0,0,16">
            <TextBlock Text="仓库URL *" FontWeight="SemiBold" Margin="0,0,0,8"/>
            <ui:TextBox x:Name="RepositoryUrlTextBox"
                        PlaceholderText="例如: https://github.com/username/repository.git"
                        Text="{Binding RepositoryUrl, UpdateSourceTrigger=PropertyChanged}"
                        Icon="{ui:SymbolIcon Link24}"/>
            <TextBlock Text="{Binding UrlValidationMessage}" 
                       Foreground="Red" 
                       FontSize="12" 
                       Margin="0,4,0,0"
                       Visibility="{Binding IsUrlValid, Converter={StaticResource InverseBooleanToVisibilityConverter}}"/>
        </StackPanel>

        <!-- 本地路径选择 -->
        <StackPanel Grid.Row="2" Margin="0,0,0,16">
            <TextBlock Text="本地存储路径 *" FontWeight="SemiBold" Margin="0,0,0,8"/>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <ui:TextBox x:Name="LocalPathTextBox"
                            Grid.Column="0"
                            PlaceholderText="选择项目存储的本地路径"
                            Text="{Binding LocalPath, UpdateSourceTrigger=PropertyChanged}"
                            Icon="{ui:SymbolIcon Folder24}"
                            Margin="0,0,8,0"/>
                <ui:Button Grid.Column="1"
                           Content="浏览"
                           Icon="{ui:SymbolIcon FolderOpen24}"
                           Command="{Binding BrowseLocalPathCommand}"/>
            </Grid>
        </StackPanel>

        <!-- 项目名称 -->
        <StackPanel Grid.Row="3" Margin="0,0,0,16">
            <TextBlock Text="项目名称" FontWeight="SemiBold" Margin="0,0,0,8"/>
            <ui:TextBox x:Name="ProjectNameTextBox"
                        PlaceholderText="将从仓库URL自动提取"
                        Text="{Binding ProjectName, UpdateSourceTrigger=PropertyChanged}"
                        Icon="{ui:SymbolIcon Document24}"/>
        </StackPanel>

        <!-- 高级选项 -->
        <Expander Grid.Row="4" 
                  Header="高级选项" 
                  Margin="0,0,0,16"
                  IsExpanded="False">
            <StackPanel Margin="0,8,0,0">
                <CheckBox Content="克隆后自动检测项目类型" 
                          IsChecked="{Binding AutoDetectProjectType}"
                          Margin="0,0,0,8"/>
                <CheckBox Content="克隆完成后立即添加到项目管理器" 
                          IsChecked="{Binding AddToProjectManager}"
                          Margin="0,0,0,8"/>
            </StackPanel>
        </Expander>

        <!-- 进度显示 -->
        <StackPanel Grid.Row="5" 
                    Visibility="{Binding IsCloning, Converter={StaticResource BoolToVisibilityConverter}}">
            <TextBlock Text="克隆进度:" FontWeight="SemiBold" Margin="0,0,0,8"/>
            <ProgressBar IsIndeterminate="True" Margin="0,0,0,8"/>
            <ScrollViewer Height="120" 
                          VerticalScrollBarVisibility="Auto"
                          Background="{DynamicResource ControlFillColorDefaultBrush}"
                          Padding="8">
                <TextBlock Text="{Binding CloneProgress}" 
                           FontFamily="Consolas"
                           FontSize="12"
                           TextWrapping="Wrap"/>
            </ScrollViewer>
        </StackPanel>
    </Grid>
</ui:ContentDialog>