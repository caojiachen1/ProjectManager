<Page
    x:Class="ProjectManager.Views.Pages.DashboardPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:ProjectManager.Views.Pages"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    Title="DashboardPage"
    d:DataContext="{d:DesignInstance local:DashboardPage,
                                     IsDesignTimeCreatable=False}"
    d:DesignHeight="450"
    d:DesignWidth="800"
    ui:Design.Background="{DynamicResource ApplicationBackgroundBrush}"
    ui:Design.Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    mc:Ignorable="d">

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid Margin="16">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- 统计卡片 -->
            <Grid Grid.Row="1" Margin="0,0,0,24">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- 总项目数 -->
                <ui:Card Grid.Column="0" Margin="0,0,8,0" Padding="16">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                            <ui:SymbolIcon Symbol="Apps24" FontSize="24" Opacity="0.7" Margin="0,0,8,0"/>
                            <TextBlock Text="总项目" FontSize="14" Opacity="0.7" VerticalAlignment="Center"/>
                        </StackPanel>
                        <TextBlock Text="{Binding ViewModel.TotalProjects}" FontSize="28" FontWeight="Bold"/>
                    </StackPanel>
                </ui:Card>

                <!-- 运行中项目 -->
                <ui:Card Grid.Column="1" Margin="8,0,8,0" Padding="16">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                            <ui:SymbolIcon Symbol="Play24" FontSize="24" Foreground="Green" Margin="0,0,8,0"/>
                            <TextBlock Text="运行中" FontSize="14" Opacity="0.7" VerticalAlignment="Center"/>
                        </StackPanel>
                        <TextBlock Text="{Binding ViewModel.RunningProjects}" FontSize="28" FontWeight="Bold" Foreground="Green"/>
                    </StackPanel>
                </ui:Card>

                <!-- 已停止项目 -->
                <ui:Card Grid.Column="2" Margin="8,0,8,0" Padding="16">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                            <ui:SymbolIcon Symbol="Stop24" FontSize="24" Opacity="0.7" Margin="0,0,8,0"/>
                            <TextBlock Text="已停止" FontSize="14" Opacity="0.7" VerticalAlignment="Center"/>
                        </StackPanel>
                        <TextBlock Text="{Binding ViewModel.StoppedProjects}" FontSize="28" FontWeight="Bold"/>
                    </StackPanel>
                </ui:Card>

                <!-- 错误项目 -->
                <ui:Card Grid.Column="3" Margin="8,0,0,0" Padding="16">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                            <ui:SymbolIcon Symbol="ErrorCircle24" FontSize="24" Foreground="Red" Margin="0,0,8,0"/>
                            <TextBlock Text="错误" FontSize="14" Opacity="0.7" VerticalAlignment="Center"/>
                        </StackPanel>
                        <TextBlock Text="{Binding ViewModel.ErrorProjects}" FontSize="28" FontWeight="Bold" Foreground="Red"/>
                    </StackPanel>
                </ui:Card>
            </Grid>

            <!-- 快速操作 -->
            <ui:Card Grid.Row="2" Padding="16" Margin="0,0,0,24">
                <StackPanel>
                    <TextBlock Text="快速操作" FontSize="18" FontWeight="SemiBold" Margin="0,0,0,16"/>
                    <StackPanel Orientation="Horizontal">
                        <ui:Button 
                            Content="新建项目" 
                            Icon="{ui:SymbolIcon Add24}"
                            Appearance="Primary"
                            Command="{Binding ViewModel.CreateProjectCommand}"
                            Margin="0,0,6,0"/>
                        <ui:Button 
                            Content="Git克隆" 
                            Icon="{ui:SymbolIcon Branch24}"
                            Command="{Binding ViewModel.GitCloneCommand}"
                            Margin="6,0,6,0"/>
                        <ui:Button 
                            Content="查看所有项目" 
                            Icon="{ui:SymbolIcon Apps24}"
                            Command="{Binding ViewModel.ViewAllProjectsCommand}"
                            Margin="6,0,6,0"/>
                        <ui:Button 
                            Content="停止所有项目" 
                            Icon="{ui:SymbolIcon Stop24}"
                            Appearance="Caution"
                            Command="{Binding ViewModel.StopAllProjectsCommand}"
                            Margin="6,0,0,0"/>
                    </StackPanel>
                </StackPanel>
            </ui:Card>

            <!-- 最近项目 -->
            <ui:Card Grid.Row="3" Padding="16">
                <StackPanel>
                    <TextBlock Text="最近项目" FontSize="18" FontWeight="SemiBold" Margin="0,0,0,16"/>
                    <ItemsControl ItemsSource="{Binding ViewModel.RecentProjects}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border BorderBrush="{DynamicResource ControlElevationBorderBrush}" 
                                        BorderThickness="1" 
                                        CornerRadius="4" 
                                        Margin="0,0,0,8" 
                                        Padding="12">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <StackPanel Grid.Column="0">
                                            <TextBlock Text="{Binding Name}" FontWeight="SemiBold"/>
                                            <TextBlock Text="{Binding Description}" Opacity="0.7" FontSize="12"/>
                                            <TextBlock Text="{Binding LastModifiedDisplay}" Opacity="0.5" FontSize="11"/>
                                        </StackPanel>

                                        <ui:Badge Grid.Column="1" 
                                                  Content="{Binding StatusDisplay}" 
                                                  Appearance="{Binding Status, Converter={StaticResource StatusToBadgeConverter}}" 
                                                  Margin="8,0,8,0"
                                                  VerticalAlignment="Center"/>

                                        <StackPanel Grid.Column="2" Orientation="Horizontal">
                                            <ui:Button 
                                                Icon="{ui:SymbolIcon Play24}"
                                                Command="{Binding DataContext.ViewModel.StartProjectCommand, RelativeSource={RelativeSource AncestorType=Page}}"
                                                CommandParameter="{Binding}"
                                                IsEnabled="{Binding Status, Converter={StaticResource StatusToStartEnabledConverter}}"
                                                ToolTip="启动项目"
                                                Margin="0,0,2,0"/>
                                            <ui:Button 
                                                Icon="{ui:SymbolIcon Stop24}"
                                                Command="{Binding DataContext.ViewModel.StopProjectCommand, RelativeSource={RelativeSource AncestorType=Page}}"
                                                CommandParameter="{Binding}"
                                                IsEnabled="{Binding Status, Converter={StaticResource StatusToStopEnabledConverter}}"
                                                ToolTip="停止项目"
                                                Margin="2,0,0,0"/>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </ui:Card>
        </Grid>
    </ScrollViewer>
</Page>
