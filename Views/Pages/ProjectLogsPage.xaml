<Page
    x:Class="ProjectManager.Views.Pages.ProjectLogsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:ProjectManager.Views.Pages"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:converters="clr-namespace:ProjectManager.Converters"
    Title="ProjectLogsPage"
    d:DataContext="{d:DesignInstance local:ProjectLogsPage,
                                     IsDesignTimeCreatable=False}"
    d:DesignHeight="450"
    d:DesignWidth="800"
    ui:Design.Background="{DynamicResource ApplicationBackgroundBrush}"
    ui:Design.Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    mc:Ignorable="d">

    <Page.Resources>
        <converters:BooleanToColorConverter x:Key="BooleanToColorConverter"/>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <converters:StatusToBadgeConverter x:Key="StatusToBadgeConverter"/>
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- 顶部工具栏 -->
        <Grid Grid.Row="0" Margin="16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- 项目信息 -->
            <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                <ui:SymbolIcon Symbol="Document24" FontSize="24" Margin="0,0,8,0"/>
                <TextBlock Text="{Binding ViewModel.ProjectName, StringFormat='项目日志 - {0}'}" 
                           FontSize="18" 
                           FontWeight="SemiBold" 
                           VerticalAlignment="Center"/>
                <ui:Badge Content="{Binding ViewModel.ProjectStatus}" 
                          Appearance="{Binding ViewModel.ProjectStatus, Converter={StaticResource StatusToBadgeConverter}}" 
                          Margin="12,0,0,0"
                          VerticalAlignment="Center"/>
            </StackPanel>

            <!-- 操作按钮 -->
            <StackPanel Grid.Column="1" Orientation="Horizontal">
                <ui:Button 
                    Content="查看终端" 
                    Icon="{ui:SymbolIcon WindowConsole20}"
                    Command="{Binding ViewModel.GoToTerminalCommand}"
                    Appearance="Primary"
                    Margin="0,0,8,0"/>
                <ui:Button 
                    Content="清空日志" 
                    Icon="{ui:SymbolIcon Delete24}"
                    Command="{Binding ViewModel.ClearLogsCommand}"
                    Margin="0,0,4,0"/>
                <ui:Button 
                    Content="导出日志" 
                    Icon="{ui:SymbolIcon Save24}"
                    Command="{Binding ViewModel.ExportLogsCommand}"
                    Margin="4,0,4,0"/>
                <ui:Button 
                    Content="刷新" 
                    Icon="{ui:SymbolIcon ArrowSync24}"
                    Command="{Binding ViewModel.RefreshCommand}"
                    Margin="4,0,4,0"/>
                <ToggleButton 
                    Content="自动滚动" 
                    IsChecked="{Binding ViewModel.AutoScroll}"
                    Margin="4,0,0,0"/>
            </StackPanel>
        </Grid>

        <!-- 日志内容 -->
        <ui:Card Grid.Row="1" Margin="16,0,16,16" Padding="0">
            <ScrollViewer x:Name="LogScrollViewer" 
                          VerticalScrollBarVisibility="Auto" 
                          HorizontalScrollBarVisibility="Auto"
                          Background="{DynamicResource ControlFillColorDefaultBrush}">
                <TextBox Text="{Binding ViewModel.LogContent, Mode=OneWay}"
                         IsReadOnly="True"
                         TextWrapping="Wrap"
                         FontFamily="Consolas, Courier New, monospace"
                         FontSize="12"
                         Background="Transparent"
                         BorderThickness="0"
                         Padding="16"
                         VerticalScrollBarVisibility="Disabled"
                         HorizontalScrollBarVisibility="Disabled"/>
            </ScrollViewer>
        </ui:Card>

        <!-- 底部状态栏 -->
        <Border Grid.Row="2" 
                Background="{DynamicResource ControlFillColorDefaultBrush}" 
                BorderBrush="{DynamicResource ControlElevationBorderBrush}"
                BorderThickness="0,1,0,0"
                Padding="16,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" 
                           Text="{Binding ViewModel.StatusText}" 
                           VerticalAlignment="Center"
                           Opacity="0.7"/>

                <TextBlock Grid.Column="1" 
                           Text="{Binding ViewModel.LogLineCount, StringFormat='共 {0} 行'}" 
                           Margin="16,0"
                           VerticalAlignment="Center"
                           Opacity="0.7"/>

                <TextBlock Grid.Column="2" 
                           Text="{Binding ViewModel.LastUpdated, StringFormat='最后更新: {0:HH:mm:ss}'}" 
                           VerticalAlignment="Center"
                           Opacity="0.7"/>
            </Grid>
        </Border>
    </Grid>
</Page>
