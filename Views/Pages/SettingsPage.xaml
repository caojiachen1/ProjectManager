<Page
    x:Class="ProjectManager.Views.Pages.SettingsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:helpers="clr-namespace:ProjectManager.Helpers"
    xmlns:local="clr-namespace:ProjectManager.Views.Pages"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    Title="SettingsPage"
    d:DataContext="{d:DesignInstance local:SettingsPage,
                                     IsDesignTimeCreatable=False}"
    d:DesignHeight="450"
    d:DesignWidth="800"
    ui:Design.Background="{DynamicResource ApplicationBackgroundBrush}"
    ui:Design.Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    mc:Ignorable="d">
    <Page.Resources>
        <helpers:EnumToBooleanConverter x:Key="EnumToBooleanConverter" />
    </Page.Resources>

    <StackPanel>
        <!-- 常规设置 分组 -->
        <TextBlock Text="{DynamicResource Settings_General}" FontSize="14" FontWeight="Medium" Margin="0,0,0,10" 
                  Foreground="{DynamicResource TextFillColorSecondaryBrush}" Opacity="0.8"/>
        
        <!-- Git可执行文件路径 -->
        <ui:Card Margin="0,0,0,8" Padding="16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel Grid.Column="0">
                    <TextBlock Text="{DynamicResource Settings_GitPath}" FontWeight="Medium" Margin="0,0,0,4"/>
                    <TextBlock Text="{DynamicResource Settings_GitPathDesc}" FontSize="12" 
                              Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                </StackPanel>
                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <ui:TextBox Text="{Binding GitExecutablePath, UpdateSourceTrigger=PropertyChanged}"
                               PlaceholderText="{DynamicResource Settings_GitPathPlaceholder}" Width="300" Margin="0,0,8,0"/>
                    <ui:Button Content="{DynamicResource Button_Browse}" Icon="{ui:SymbolIcon FolderOpen24}"
                              Command="{Binding BrowseGitExecutablePathCommand}" Appearance="Secondary"/>
                </StackPanel>
            </Grid>
        </ui:Card>
        
        <!-- Git用户名 -->
        <ui:Card Margin="0,0,0,8" Padding="16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel Grid.Column="0">
                    <TextBlock Text="{DynamicResource Settings_GitUsername}" FontWeight="Medium" Margin="0,0,0,4"/>
                    <TextBlock Text="{DynamicResource Settings_GitUsernameDesc}" FontSize="12" 
                              Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                </StackPanel>
                <ui:TextBox Grid.Column="1" Text="{Binding GitUserName, UpdateSourceTrigger=PropertyChanged}"
                           PlaceholderText="{DynamicResource Settings_GitUsernamePlaceholder}" Width="300" VerticalAlignment="Center"/>
            </Grid>
        </ui:Card>
        
        <!-- Git邮箱 -->
        <ui:Card Margin="0,0,0,8" Padding="16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel Grid.Column="0">
                    <TextBlock Text="{DynamicResource Settings_GitEmail}" FontWeight="Medium" Margin="0,0,0,4"/>
                    <TextBlock Text="{DynamicResource Settings_GitEmailDesc}" FontSize="12" 
                              Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                </StackPanel>
                <ui:TextBox Grid.Column="1" Text="{Binding GitUserEmail, UpdateSourceTrigger=PropertyChanged}"
                           PlaceholderText="{DynamicResource Settings_GitEmailPlaceholder}" Width="300" VerticalAlignment="Center"/>
            </Grid>
        </ui:Card>
        
        <!-- 默认Git分支 -->
        <ui:Card Margin="0,0,0,8" Padding="16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel Grid.Column="0">
                    <TextBlock Text="{DynamicResource Settings_DefaultBranch}" FontWeight="Medium" Margin="0,0,0,4"/>
                    <TextBlock Text="{DynamicResource Settings_DefaultBranchDesc}" FontSize="12" 
                              Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                </StackPanel>
                <ui:TextBox Grid.Column="1" Text="{Binding DefaultGitBranch, UpdateSourceTrigger=PropertyChanged}"
                           PlaceholderText="main" Width="200" VerticalAlignment="Center"/>
            </Grid>
        </ui:Card>
        
        <!-- 自动获取Git更新 -->
        <ui:Card Margin="0,0,0,20" Padding="16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel Grid.Column="0">
                    <TextBlock Text="{DynamicResource Settings_AutoFetchGit}" FontWeight="Medium" Margin="0,0,0,4"/>
                    <TextBlock Text="{DynamicResource Settings_AutoFetchGitDesc}" FontSize="12" 
                              Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                </StackPanel>
                <CheckBox Grid.Column="1" IsChecked="{Binding AutoFetchGitUpdates}" VerticalAlignment="Center"/>
            </Grid>
        </ui:Card>
        
        <!-- 项目设置 分组 -->
        <TextBlock Text="{DynamicResource Settings_Project}" FontSize="14" FontWeight="Medium" Margin="0,0,0,10" 
                  Foreground="{DynamicResource TextFillColorSecondaryBrush}" Opacity="0.8"/>
        
        <!-- 默认项目路径 -->
        <ui:Card Margin="0,0,0,8" Padding="16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel Grid.Column="0">
                    <TextBlock Text="{DynamicResource Settings_DefaultProjectPath}" FontWeight="Medium" Margin="0,0,0,4"/>
                    <TextBlock Text="{DynamicResource Settings_DefaultProjectPathDesc}" FontSize="12" 
                              Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                </StackPanel>
                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <ui:TextBox Text="{Binding DefaultProjectPath, UpdateSourceTrigger=PropertyChanged}"
                               PlaceholderText="{DynamicResource Settings_DefaultProjectPathPlaceholder}" Width="300" Margin="0,0,8,0"/>
                    <ui:Button Content="{DynamicResource Button_Browse}" Icon="{ui:SymbolIcon FolderOpen24}"
                              Command="{Binding BrowseDefaultProjectPathCommand}" Appearance="Secondary"/>
                </StackPanel>
            </Grid>
        </ui:Card>
        
        <!-- 自动启动项目 -->
        <ui:Card Margin="0,0,0,8" Padding="16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel Grid.Column="0">
                    <TextBlock Text="{DynamicResource Settings_AutoStart}" FontWeight="Medium" Margin="0,0,0,4"/>
                    <TextBlock Text="{DynamicResource Settings_AutoStartDesc}" FontSize="12" 
                              Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                </StackPanel>
                <CheckBox Grid.Column="1" IsChecked="{Binding AutoStartProjects}" VerticalAlignment="Center"/>
            </Grid>
        </ui:Card>
        
        <!-- 自动保存项目 -->
        <ui:Card Margin="0,0,0,8" Padding="16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel Grid.Column="0">
                    <TextBlock Text="{DynamicResource Settings_AutoSave}" FontWeight="Medium" Margin="0,0,0,4"/>
                    <TextBlock Text="{DynamicResource Settings_AutoSaveDesc}" FontSize="12" 
                              Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                </StackPanel>
                <CheckBox Grid.Column="1" IsChecked="{Binding AutoSaveProjects}" VerticalAlignment="Center"/>
            </Grid>
        </ui:Card>
        
        <!-- 项目刷新间隔 -->
        <ui:Card Margin="0,0,0,8" Padding="16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel Grid.Column="0">
                    <TextBlock Text="{DynamicResource Settings_RefreshInterval}" FontWeight="Medium" Margin="0,0,0,4"/>
                    <TextBlock Text="{DynamicResource Settings_RefreshIntervalDesc}" FontSize="12" 
                              Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                </StackPanel>
                <ui:NumberBox Grid.Column="1" Value="{Binding ProjectRefreshInterval}" 
                             Minimum="10" Maximum="300" Width="150" VerticalAlignment="Center"/>
            </Grid>
        </ui:Card>
        
        <!-- 最大最近项目数 -->
        <ui:Card Margin="0,0,0,20" Padding="16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel Grid.Column="0">
                    <TextBlock Text="{DynamicResource Settings_MaxRecentProjects}" FontWeight="Medium" Margin="0,0,0,4"/>
                    <TextBlock Text="{DynamicResource Settings_MaxRecentProjectsDesc}" FontSize="12" 
                              Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                </StackPanel>
                <ui:NumberBox Grid.Column="1" Value="{Binding MaxRecentProjects}" 
                             Minimum="5" Maximum="50" Width="150" VerticalAlignment="Center"/>
            </Grid>
        </ui:Card>
        
        <!-- 应用程序设置 分组 -->
        <TextBlock Text="{DynamicResource Settings_Application}" FontSize="14" FontWeight="Medium" Margin="0,0,0,10" 
                  Foreground="{DynamicResource TextFillColorSecondaryBrush}" Opacity="0.8"/>
        
        <!-- 首选终端 -->
        <ui:Card Margin="0,0,0,8" Padding="16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel Grid.Column="0">
                    <TextBlock Text="{DynamicResource Settings_PreferredTerminal}" FontWeight="Medium" Margin="0,0,0,4"/>
                    <TextBlock Text="{DynamicResource Settings_PreferredTerminalDesc}" FontSize="12" 
                              Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                </StackPanel>
                <ComboBox Grid.Column="1" SelectedValue="{Binding PreferredTerminal}" SelectedValuePath="Content" 
                         Width="200" VerticalAlignment="Center">
                    <ComboBoxItem Content="PowerShell"/>
                    <ComboBoxItem Content="CMD"/>
                    <ComboBoxItem Content="Git Bash"/>
                </ComboBox>
            </Grid>
        </ui:Card>
        
        <!-- 显示通知 -->
        <ui:Card Margin="0,0,0,8" Padding="16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel Grid.Column="0">
                    <TextBlock Text="{DynamicResource Settings_ShowNotifications}" FontWeight="Medium" Margin="0,0,0,4"/>
                    <TextBlock Text="{DynamicResource Settings_ShowNotificationsDesc}" FontSize="12" 
                              Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                </StackPanel>
                <CheckBox Grid.Column="1" IsChecked="{Binding ShowNotifications}" VerticalAlignment="Center"/>
            </Grid>
        </ui:Card>

        <!-- 终端时间戳 -->
        <ui:Card Margin="0,0,0,8" Padding="16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel Grid.Column="0">
                    <TextBlock Text="{DynamicResource Settings_TerminalTimestamps}" FontWeight="Medium" Margin="0,0,0,4"/>
                    <TextBlock Text="{DynamicResource Settings_TerminalTimestampsDesc}" FontSize="12" 
                              Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                </StackPanel>
                <CheckBox Grid.Column="1" IsChecked="{Binding ShowTerminalTimestamps}" VerticalAlignment="Center"/>
            </Grid>
        </ui:Card>
        
        <!-- 使用UTF8编码 -->
        <ui:Card Margin="0,0,0,8" Padding="16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel Grid.Column="0">
                    <TextBlock Text="{DynamicResource Settings_CmdUtf8}" FontWeight="Medium" Margin="0,0,0,4"/>
                    <TextBlock Text="{DynamicResource Settings_CmdUtf8Desc}" FontSize="12" 
                              Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                </StackPanel>
                <CheckBox Grid.Column="1" IsChecked="{Binding UseCmdChcp65001}" VerticalAlignment="Center"/>
            </Grid>
        </ui:Card>
        
        <!-- 默认启动页面 -->
        <ui:Card Margin="0,0,0,20" Padding="16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel Grid.Column="0">
                    <TextBlock Text="{DynamicResource Settings_DefaultStartupPage}" FontWeight="Medium" Margin="0,0,0,4"/>
                    <TextBlock Text="{DynamicResource Settings_DefaultStartupPageDesc}" FontSize="12" 
                              Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                </StackPanel>
                <ComboBox Grid.Column="1" SelectedValue="{Binding DefaultStartupPage}" SelectedValuePath="Tag" 
                         Width="200" VerticalAlignment="Center">
                    <ComboBoxItem Content="{DynamicResource Nav_Dashboard}" Tag="Dashboard"/>
                    <ComboBoxItem Content="{DynamicResource Nav_Projects}" Tag="Projects"/>
                    <ComboBoxItem Content="{DynamicResource Nav_Terminal}" Tag="Terminal"/>
                    <ComboBoxItem Content="{DynamicResource Nav_Performance}" Tag="Performance"/>
                </ComboBox>
            </Grid>
        </ui:Card>
        
        <!-- 外观设置 分组 -->
        <TextBlock Text="{DynamicResource Settings_Appearance}" FontSize="14" FontWeight="Medium" Margin="0,0,0,10" 
                  Foreground="{DynamicResource TextFillColorSecondaryBrush}" Opacity="0.8"/>
        
        <!-- 语言设置 -->
        <ui:Card Margin="0,0,0,8" Padding="16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel Grid.Column="0">
                    <TextBlock Text="{DynamicResource Settings_Language}" FontWeight="Medium" Margin="0,0,0,4"/>
                    <TextBlock Text="{DynamicResource Settings_LanguageDesc}" FontSize="12" 
                              Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                </StackPanel>
                <ComboBox Grid.Column="1" 
                         ItemsSource="{Binding AvailableLanguages}" 
                         SelectedValue="{Binding SelectedLanguage, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         SelectedValuePath="Code"
                         Width="260" VerticalAlignment="Center">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock>
                                <Run Text="{Binding NativeName}"/>
                                <Run Text=" ("/>
                                <Run Text="{Binding DisplayName}"/>
                                <Run Text=")"/>
                            </TextBlock>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>
            </Grid>
        </ui:Card>
        
        <!-- 主题 -->
        <ui:Card Margin="0,0,0,20" Padding="16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel Grid.Column="0">
                    <TextBlock Text="{DynamicResource Settings_Theme}" FontWeight="Medium" Margin="0,0,0,4"/>
                    <TextBlock Text="{DynamicResource Settings_ThemeDesc}" FontSize="12" 
                              Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                </StackPanel>
                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <RadioButton Content="{DynamicResource Settings_ThemeLight}" GroupName="themeSelect" Margin="0,0,20,0"
                               Command="{Binding ChangeThemeCommand, Mode=OneWay}" CommandParameter="theme_light"
                               IsChecked="{Binding CurrentTheme, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Light, Mode=OneWay}"/>
                    <RadioButton Content="{DynamicResource Settings_ThemeDark}" GroupName="themeSelect"
                               Command="{Binding ChangeThemeCommand, Mode=OneWay}" CommandParameter="theme_dark"
                               IsChecked="{Binding CurrentTheme, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Dark, Mode=OneWay}"/>
                </StackPanel>
            </Grid>
        </ui:Card>
        
        <!-- 操作 分组 -->
        <TextBlock Text="{DynamicResource Settings_Actions}" FontSize="14" FontWeight="Medium" Margin="0,0,0,10" 
                  Foreground="{DynamicResource TextFillColorSecondaryBrush}" Opacity="0.8"/>
        
        <!-- 设置管理 -->
        <ui:Card Margin="0,0,0,8" Padding="16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel Grid.Column="0">
                    <TextBlock Text="{DynamicResource Settings_Management}" FontWeight="Medium" Margin="0,0,0,4"/>
                    <TextBlock Text="{DynamicResource Settings_ManagementDesc}" FontSize="12" 
                              Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                </StackPanel>
                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <ui:Button Content="{DynamicResource Settings_Save}" Icon="{ui:SymbolIcon Save24}" Appearance="Primary"
                              Command="{Binding SaveSettingsCommand}" Margin="0,0,10,0"/>
                    <ui:Button Content="{DynamicResource Settings_Reset}" Icon="{ui:SymbolIcon ArrowReset24}" Appearance="Caution"
                              Command="{Binding ResetSettingsCommand}"/>
                </StackPanel>
            </Grid>
        </ui:Card>
        
        <!-- 关于 分组 -->
        <TextBlock Text="{DynamicResource Settings_About}" FontSize="14" FontWeight="Medium" Margin="0,20,0,10" 
                  Foreground="{DynamicResource TextFillColorSecondaryBrush}" Opacity="0.8"/>
        
        <!-- 应用程序版本 -->
        <ui:Card Margin="0,0,0,20" Padding="16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel Grid.Column="0">
                    <TextBlock Text="{DynamicResource Settings_AppVersion}" FontWeight="Medium" Margin="0,0,0,4"/>
                    <TextBlock Text="{DynamicResource Settings_AppVersionDesc}" FontSize="12" 
                              Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                </StackPanel>
                <TextBlock Grid.Column="1" Text="{Binding AppVersion, Mode=OneWay}" VerticalAlignment="Center" 
                          FontFamily="Consolas" Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
            </Grid>
        </ui:Card>
        
    </StackPanel>
</Page>